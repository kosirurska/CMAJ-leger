---
title: "Psychological distress during COVID-19 in Canadian youth with chronic health conditions and health peers"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load the libraries
library(tidyverse)
library(readr)
library(here)
library(psych)
library(english)
library(stringr)
library(tableone)
library(kableExtra)
library(scales)
library(ggridges)
library(plotly)
library(patchwork)
library(haven)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(table1)
```

```{r data, echo=FALSE, message=FALSE, warning=FALSE}
# Read in the clean csv file
leger <- read_csv("data/cmaj_analyses.csv")

# subset for chronic people only
leger_chronic <- leger %>%
  filter(chronic_dummy == 1)
```

#### Aims:
Using Canadian representative samples, we aimed 

1) Report any differences in psychological functioning (feelings of anxiety, depression, loneliness, anger/frustration)  among young people with different medical needs, and see how it changed over the course of the pandemic;

2) compare young people with any chronic health condition to their healthy peers in terms of COVID-19 impact on psychological functioning.

## METHOD

The present study is part of a larger International COVID‐19 Awareness and Responses Evaluation (iCARE) study, which is a global multi‐phase research survey conducted through the Montreal Behavioural Medicine Centre. Find more about the study and materials at [www.iCAREstudy.com](www.iCAREstudy.com). 

## RESULTS
### Sample

```{r echo=FALSE, warning=FALSE}
table_data <- leger %>%
  select(age_yrs, sex, edu, hoinc, province_full, chronic_descriptive, chronic_dummy, chronic_multi, any_m_health, vaccine, booster_dummy) %>%
  mutate(chronic_dummy = factor(chronic_dummy,
                                levels = c(0:1),
                                labels = c("Healthy", "Chronic Health Condition")),
         chronic_multi = factor(chronic_multi, 
                                levels = c(0:1),
                                labels = c("No", "Yes")),
         any_m_health = factor(any_m_health,
                               levels = c(0:1),
                               labels = c("No", "Yes")))

label(table_data$sex) <- "Sex"
label(table_data$age_yrs) <- "Age"
label(table_data$edu) <- "Education"
label(table_data$province_full) <- "Province"
label(table_data$hoinc) <- "Income"
label(table_data$chronic_descriptive) <- "Chronic illness"
label(table_data$chronic_multi) <- "Multimorbidity"
label(table_data$any_m_health) <- "Diagnosis of mental health disorder"
label(table_data$vaccine) <- "Received COVID-19 vaccine?"
label(table_data$booster_dummy) <- "Likelihood of taking COVID-19 booster dose?"

units(table_data$age_yrs) <- "years"

table1(~ age_yrs + sex + edu + hoinc + province_full + chronic_descriptive + chronic_multi + any_m_health + vaccine + booster_dummy | chronic_dummy,
       data = table_data)

```

### Psychological functioning over time

```{r echo=FALSE, warning=FALSE}
leger %>%
  #filter(age_yrs >25) %>%
  select(chronic_dummy, wave, distress_rev) %>%
  mutate(chronic_dummy = factor(chronic_dummy,
                                levels = c(0:1),
                                labels = c("No", "Yes")),
         wave = as.factor(wave)) %>%
  ggplot(aes(x = wave)) +
  geom_boxplot(aes(y = distress_rev, fill=chronic_dummy)) +
  #facet_wrap(~chronic_dummy) +
  labs(title = " ", x = "Survey round", y = "Level of psychological distress", fill = "Chronic condition") +
  ylim(3, 20) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_discrete(breaks = c(2, 3, 4, 5, 6, 7),
                     labels = c("Mid June \n2020", "Early Nov. \n2020", "Late Jan. \n2021",
                                "Late March \n2021", "Early June \n2021", "Mid Sept. \n2021"))
```

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.width= 12, fig.height=6}
leger %>%
  mutate(age_grp = factor(case_when(age_yrs <26 ~ "Under 25 years",
                                    age_yrs >25 ~ "26-39 years"),
                          levels = c("Under 25 years", "26-39 years"),
                          ordered = TRUE),
         chronic_dummy = factor(chronic_dummy, 
                                levels = c(0:1),
                                labels = c("Healthy", "Chronic health"))) %>%
ggplot(aes(distress_rev, fill=chronic_dummy)) + 
  geom_density(alpha=.3) + 
  scale_fill_viridis_d(option = "D") +
  theme_bw(base_size = 15) +
  theme(panel.grid.minor = element_blank(), 
        panel.grid.major = element_blank(),
        strip.text = element_text(face = 'bold')) + 
  labs(x = "Distress", y = "Density", fill = " ") +
  facet_grid(~age_grp)


leger %>%
  mutate(age_grp = factor(case_when(age_yrs <26 ~ "Under 25 years",
                                    age_yrs >25 ~ "26-39 years"),
                          levels = c("Under 25 years", "26-39 years"),
                          ordered = TRUE),
         chronic_dummy = factor(chronic_dummy, 
                                levels = c(0:1),
                                labels = c("Healthy", "Chronic health"))) %>%
  group_by(age_grp, chronic_dummy) %>%
  count() %>%
  drop_na() %>%
  group_by(age_grp) %>%
  mutate(sum_grp = sum(n),
         prop = round((n/sum_grp*100),2)) %>%
  select(-sum_grp) %>%
  kable() %>%
  kable_styling(full_width = FALSE)

# a<-leger %>%
#   filter(chronic_dummy==0)
# 
# hist(a$distress_rev)
```
## Group comparisons

Psych distress is known to be a function of sex and age, with females and younger people reporting more distress

```{r echo=FALSE, warning=FALSE, message=FALSE}
test <- leger %>%
  select(age_yrs, sex, chronic_dummy, distress_rev) %>%
  filter(sex %in% c("Female", "Male")) %>%
  mutate(age_grp = factor(case_when(age_yrs <26 ~ "Under 25 years",
                                    age_yrs >25 ~ "26-39 years"),
                          levels = c("Under 25 years", "26-39 years"),
                          ordered = TRUE),
         chronic_dummy = factor(chronic_dummy, 
                                levels = c(0:1),
                                labels = c("Healthy", "Chronic health")))
## 2 WAY ANOVA  
# test_model <- lm(distress_rev ~ age_grp + chronic_dummy + age_grp : chronic_dummy,
#                  data = test)
# 
# anova(test_model)

test %>%
  group_by(age_grp, chronic_dummy, sex) %>%
  summarise(means = mean(distress_rev, na.rm = TRUE)) %>%
  ggplot(aes(x = age_grp, y = means, color = chronic_dummy, group = chronic_dummy)) +
  geom_point(size = 4) + 
  geom_line() +
  facet_wrap(~sex) +
  theme_bw(base_size = 15) +
  theme(strip.text = element_text(face = 'bold')) + 
  labs(x = "Age group", y = "Distress level", fill = " ") +
  ylim(4, 16)
```

## ADDED DISTRESS

```{r}
# bring in the variables for alcohol, cigarettes, vapes, recreational drugs

```



### Associations between psych distress and socio-demographic factors

#### Logistic regression output

*NOTE* - Education is treated as continuous variable with the following levels: "never been" ~ 0, "primary" ~ 1,"secondary" ~ 2, "college" ~ 3, "graduate" ~ 4.

Province is broken down into 3 geographical regions: 

* *East* = "New Brunswick", "Nova Scotia", "Prince Edward Island", "Newfoundland"
* *Central* = "Ontario", "Quebec"
* *West* = "British Columbia", "Alberta", "Saskatchewan", "Manitoba"

Distress rev = compound score of COVID-19 related feelings of anxiety, depression, and loneliness. Scale rangess from 4 - 16, with higher scores indicating higher levels of pandemic-related distress.

***

## CHRONIC GROUP

```{r echo=FALSE, warning=FALSE}
set.seed(1)

leger_chronic_m1 <- leger_chronic %>%
  select(vaccine_dummy, age_yrs, sex, hoinc, edu, province, wave, any_m_health, chronic_multi, distress_rev, concern_sq002) %>%
  filter(sex %in% c("Male", "Female")) %>%
  mutate(education = as.numeric(case_when(edu == "Never been" ~ 0, 
                                          edu == "Primary" ~ 1,
                                          edu == "Secondary" ~ 2,
                                          edu == "College" ~ 3,
                                          edu == "Graduate" ~ 4)))

m1_chronic <- glm(distress_rev ~ age_yrs + sex + province + education + hoinc + any_m_health + chronic_multi + wave + concern_sq002,
                  data = leger_chronic_m1)

tab_model(m1_chronic)

```

## HEALTHY GROUP
```{r echo=FALSE, warning=FALSE}
set.seed(1)

leger_healthy_m1 <- leger %>%
  filter(chronic_dummy == 0) %>%
  select(vaccine_dummy, age_yrs, sex, hoinc, edu, province, wave, any_m_health, chronic_multi, distress_rev, concern_sq002) %>%
  filter(sex %in% c("Male", "Female")) %>%
  mutate(education = as.numeric(case_when(edu == "Never been" ~ 0, 
                                          edu == "Primary" ~ 1,
                                          edu == "Secondary" ~ 2,
                                          edu == "College" ~ 3,
                                          edu == "Graduate" ~ 4)))

m1_healthy <- glm(distress_rev ~ age_yrs + sex + province + education + hoinc + any_m_health + wave + concern_sq002,
                  data = leger_healthy_m1)

tab_model(m1_healthy)
```

## DISCUSSION

